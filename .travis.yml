language: elixir
elixir:
- 1.6.6
otp_release:
- 21.0.1
services:
- postgresql
addons:
  postgresql: '9.5'
  chrome: stable
install:
- wget -N http://chromedriver.storage.googleapis.com/2.40/chromedriver_linux64.zip -P ~/
- unzip ~/chromedriver_linux64.zip -d ~/
- rm ~/chromedriver_linux64.zip
- sudo mv -f ~/chromedriver /usr/local/share/
- sudo chmod +x /usr/local/share/chromedriver
- sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver
- sudo apt-get install -y postgresql-9.5-postgis-2.3
- sudo service postgresql restart
- mix local.rebar --force
- mix local.hex --force
- mix deps.get
script:
- mix format --check-formatted && mix credo --strict
- MIX_ENV=test mix do ecto.create, ecto.migrate && mix coveralls.travis --umbrella
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && npm install
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && ./node_modules/.bin/eslint js/**/*.js
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && node node_modules/webpack/bin/webpack.js --mode development
- cd $TRAVIS_BUILD_DIR
deploy:
  provider: heroku
  api_key:
    secure: bcX85oZkOvHhYEQmYV/DUHlFEhDGU7Su3V6Vd3ZTUub2QZfGTIRck1CWf8eh1ODhb1Y3B+zETP+IniR7NDVuOs3wQc01jcjWtOVEZ+eZ1tCMzcKjwY5FXThEpKcS0RcBGg/GM2eDPOnlqw/ZXaKO0qEL6YALSHmy0Qxyo9SKs6t2t52OzjPOd0xMIG6+PrlwHT2ofbpA3EhLYlU1UpOyCKCuDHUK8/At+obKiG1Psu9VtlHRdI2537CTsAhIugKt7LVNv0EnFG++pRreK6nkLwgA9KJedkuqCH2EjjMMbuITQnXVfXSqWimSA994veCyZRZERzULFe+QOyNxPCgN3K55PKft3Y8/h7/1P8vnPhSJ1Oi3xTryffDipVpNZLhg1i0+NFl/7EPRcGlCAvh8KIs22Cml9V55Pw20pZz/yAxLVHoiC+LPrfoiKQ5qIZUExiyawLmy4QlKvWbAmECpC1ZfH/xdkRW3x1Xy51wu76QVO/K302N3yGmvCZ24k5FF0pZWg8DNzhdN3UTkf8fMeKH9G9y0clKm2R/7iXfXonJgR6st50IM6LShqgA8IVIDqLigLtl0Zqcb+rWOuHZBbFFDxc0juaoDBaOWtRAovcTED0IAnlCxtUxMpCUKvdLOd489fnRV/UvH21UfVVtbjoJGoqMXogR72j9f015V5mU=
  app:
    master: busdetective-ng-staging
  on:
    repo: bus-detective/bus_detective_ng
  run: mix ecto.migrate
