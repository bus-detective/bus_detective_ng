language: elixir
elixir:
- 1.6.6
otp_release:
- 21.0.1
services:
- postgresql
addons:
  postgresql: '9.5'
  chrome: stable
install:
- wget -N http://chromedriver.storage.googleapis.com/2.40/chromedriver_linux64.zip -P ~/
- unzip ~/chromedriver_linux64.zip -d ~/
- rm ~/chromedriver_linux64.zip
- sudo mv -f ~/chromedriver /usr/local/share/
- sudo chmod +x /usr/local/share/chromedriver
- sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver
- sudo apt-get install -y postgresql-9.5-postgis-2.3
- sudo service postgresql restart
- mix local.rebar --force
- mix local.hex --force
- mix deps.get
script:
- mix format --check-formatted && mix credo --strict
- MIX_ENV=test mix do ecto.create, ecto.migrate && mix coveralls.travis --umbrella
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && npm install
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && ./node_modules/.bin/eslint js/**/*.js
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && node node_modules/webpack/bin/webpack.js --mode development
- cd $TRAVIS_BUILD_DIR
deploy:
  provider: heroku
  api_key:
    secure: gECRCkmieThcHfXkkuOJj0CymRmIRa8H+se/XCz0qMnaJLAvwFIA6zxtz2sCmmLXx+jrijAnGqYOjyqtkhmKOOnoyV0oYq4eVwUNOWbEIVZXhRtDQfOmlm8I0HZ5eaSzskYchqXRtbOx7eTB6opDW5LJ9S/nr9BPO0SaL7uK7+rURfYxXS0LkEYe/hKri/GEhO7eIlYsRBAMrPvD++Q8d8lsk2CiQ8rJXY4YEyV7/+M+tGIAmNKeS+G1mjEAcPdAS9gElIIlC/XDHOqfW0t1074A3vbN23R/lFS6fVXvey0ZMDoAtiqNGckOvhYb2z65GUcWQ7fdg95MwHjoCMxHlX5IMTiZ+awLEMRSWUYFs2Kiqnd/J5Sh0t4Cxn/m51R34U/NIjlronPutGbwNeB6sOMQolYviEQs45cF8mf5UsBO5HriOOzfGYA8gtSFEi/r4u4x23fB6wFR212hQa3qZ3J5Bh0MsPKi2zNRn6rgFQHDRnRlDdNtx+ysDXAMtDp8ATTi5cpvrWrDwSn3F6IHPoPu11YBHlo8qHllygCKv+f2PR2i+EAZTEIjDVBoX/YHtrFG2xt+UjaHyQwLE6USKYFA7Uy5IFx4mYxrKYmzQJzcpG/0p37RhsPQcnMHddCF3w9pbtUgBbw66W5lvLbNkhs+z7RvKcUyH4PdRnwjKi0=
  app:
    master: busdetective-ng-staging
  on:
    repo: bus-detective/bus_detective_ng
  run: mix ecto.migrate
