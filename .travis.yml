language: elixir
elixir:
- 1.6.6
otp_release:
- 21.0.1
services:
- postgresql
addons:
  postgresql: '9.5'
  chrome: stable
install:
- wget -N http://chromedriver.storage.googleapis.com/2.40/chromedriver_linux64.zip
  -P ~/
- unzip ~/chromedriver_linux64.zip -d ~/
- rm ~/chromedriver_linux64.zip
- sudo mv -f ~/chromedriver /usr/local/share/
- sudo chmod +x /usr/local/share/chromedriver
- sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver
- sudo apt-get install -y postgresql-9.5-postgis-2.3
- sudo service postgresql restart
- mix local.rebar --force
- mix local.hex --force
- mix deps.get
script:
- mix format --check-formatted && mix credo --strict
- MIX_ENV=test mix do ecto.create, ecto.migrate && mix coveralls.travis --umbrella
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && npm install
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && ./node_modules/.bin/eslint
  js/**/*.js
- cd $TRAVIS_BUILD_DIR/apps/bus_detective_web/assets && node node_modules/webpack/bin/webpack.js
  --mode development
- cd $TRAVIS_BUILD_DIR
deploy:
  - provider: heroku
    app:
      master: busdetective-ng-staging
    on:
      repo: bus-detective/bus_detective_ng
    run: mix ecto.migrate
    api_key:
      secure: "nsDapZcs4ocuZ+yngUGa2gjHcbKxMhS2/mPY3mI6z6u4/g1vuYtr23xorbq9nqNPJI9pZGjAvvr28be3Kq1zlbMMUQapVF25IWKlZD+kufN7yHdxYBykde+juW6ua4BleAnlVi61tR8QYIWHBHlStYT1A6VLNFJNzSlz3SokEtWnGY5H1jML5+JFMcQ1CRWm8uzHgVIE7drTPESIEqLc05GYFzP+VpuTII1CoQnKKF8Z5tDUEYdd+xDmPGY+5EZBG7yNP05bfRlNzc2CTIOSuh0Mb0Uh0x3JxeG5wY++rfSsIVr99iJOJuR3DZ/N0A/VLMdd9fN/3rYQtrpQaFooNRkRs7IHFacILYjLiSNhRQ71vfh1ogf8eAtTk7sFrn0+1PCm/AY96wfgjALlJS7nkQGLWpEnA2NLEo2yjs6FAFfEMEX51VElAriD6FyA9guqkmbD+nvWD1BG/542EZZeoryPi04C+DCBD/MFM5KreKK/9stgE+PtwlOZCDNkPoPH8qQZz76awRSL3isZPZH5HJJPNNwy82XHRaNGUiH42Nz59VUHTeHGmaV4/QiB3uNHQcnwumci1ZvQaGLzSo8msm8EUJ0YYUtC8r1ivgU53nKNb5y3dZD4C0PPFoz/yHFTKqjTnb0kVOkQHyAss0C75w79vNWCAGYwaJ2lwGnphPw="
  - provider: heroku
    app: busdetective-ng
    on:
      repo: bus-detective/bus_detective_ng
      all_branches: true
      condition: "$TRAVIS_TAG =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+"
    run: mix ecto.migrate
    api_key:
      secure: "nsDapZcs4ocuZ+yngUGa2gjHcbKxMhS2/mPY3mI6z6u4/g1vuYtr23xorbq9nqNPJI9pZGjAvvr28be3Kq1zlbMMUQapVF25IWKlZD+kufN7yHdxYBykde+juW6ua4BleAnlVi61tR8QYIWHBHlStYT1A6VLNFJNzSlz3SokEtWnGY5H1jML5+JFMcQ1CRWm8uzHgVIE7drTPESIEqLc05GYFzP+VpuTII1CoQnKKF8Z5tDUEYdd+xDmPGY+5EZBG7yNP05bfRlNzc2CTIOSuh0Mb0Uh0x3JxeG5wY++rfSsIVr99iJOJuR3DZ/N0A/VLMdd9fN/3rYQtrpQaFooNRkRs7IHFacILYjLiSNhRQ71vfh1ogf8eAtTk7sFrn0+1PCm/AY96wfgjALlJS7nkQGLWpEnA2NLEo2yjs6FAFfEMEX51VElAriD6FyA9guqkmbD+nvWD1BG/542EZZeoryPi04C+DCBD/MFM5KreKK/9stgE+PtwlOZCDNkPoPH8qQZz76awRSL3isZPZH5HJJPNNwy82XHRaNGUiH42Nz59VUHTeHGmaV4/QiB3uNHQcnwumci1ZvQaGLzSo8msm8EUJ0YYUtC8r1ivgU53nKNb5y3dZD4C0PPFoz/yHFTKqjTnb0kVOkQHyAss0C75w79vNWCAGYwaJ2lwGnphPw="
  - provider: heroku
    app: busdetective-ng-seattle
    on:
      repo: bus-detective/bus_detective_ng
      all_branches: true
      condition: "$TRAVIS_TAG =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+"
    run: mix ecto.migrate
    api_key:
      secure: "nsDapZcs4ocuZ+yngUGa2gjHcbKxMhS2/mPY3mI6z6u4/g1vuYtr23xorbq9nqNPJI9pZGjAvvr28be3Kq1zlbMMUQapVF25IWKlZD+kufN7yHdxYBykde+juW6ua4BleAnlVi61tR8QYIWHBHlStYT1A6VLNFJNzSlz3SokEtWnGY5H1jML5+JFMcQ1CRWm8uzHgVIE7drTPESIEqLc05GYFzP+VpuTII1CoQnKKF8Z5tDUEYdd+xDmPGY+5EZBG7yNP05bfRlNzc2CTIOSuh0Mb0Uh0x3JxeG5wY++rfSsIVr99iJOJuR3DZ/N0A/VLMdd9fN/3rYQtrpQaFooNRkRs7IHFacILYjLiSNhRQ71vfh1ogf8eAtTk7sFrn0+1PCm/AY96wfgjALlJS7nkQGLWpEnA2NLEo2yjs6FAFfEMEX51VElAriD6FyA9guqkmbD+nvWD1BG/542EZZeoryPi04C+DCBD/MFM5KreKK/9stgE+PtwlOZCDNkPoPH8qQZz76awRSL3isZPZH5HJJPNNwy82XHRaNGUiH42Nz59VUHTeHGmaV4/QiB3uNHQcnwumci1ZvQaGLzSo8msm8EUJ0YYUtC8r1ivgU53nKNb5y3dZD4C0PPFoz/yHFTKqjTnb0kVOkQHyAss0C75w79vNWCAGYwaJ2lwGnphPw="
